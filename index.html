<!-- @format -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sticky Wall</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: sans-serif;
        background: #f5f5f5;
      }

      .container {
        width: 100%;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #stickyWall {
        width: 100%;
        height: 100vh;
        background: #f5f5f5;
        position: relative;
      }
      .plus-task {
        position: fixed;
        bottom: 0;
        left: 0;
        margin: 10px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: #8e44ad;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        color: white;
        font-size: 30px;
      }

      #newStickyText {
        border: 1px solid #ccc;
        padding: 5px;
        border-radius: 5px;
        min-height: 30px;
        width: 100%;
        outline: none;
        font-size: 16px;
      }

      .sticky {
        width: 250px;
        height: 250px;
        padding: 10px;
        position: absolute;
        display: flex;
        flex-direction: row;
        cursor: move;
        border-radius: 10px;
        background: linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.9),
            rgba(255, 255, 255, 0.9)
          ),
          repeating-linear-gradient(
            0deg,
            transparent,
            transparent 4.8mm,
            rgba(0, 0, 0, 0.1) 4.8mm,
            rgba(0, 0, 0, 0.1) 5mm
          );
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
      }
      .sticky-inner-content {
        width: calc(100% - 20px); /* 10px padding on both sides */
        height: calc(100% - 20px); /* 10px padding on both sides */
        overflow-y: auto;
        padding: 5px;
      }
      .sticky-inner-content {
        -ms-overflow-style: none;
        scrollbar-width: none; /* hide scroll bar in Firefox */
        /* hide scroll bar in IE and Edge */
      }

      .sticky-inner-content::-webkit-scrollbar {
        display: none; /* hide scroll bar */
      }
      .stickyTitle {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 20px;
        outline: none;
        cursor: text;
        text-align: center;
        border-bottom: 1px solid #ccc;
        position: sticky;
      }
      .stickyText {
        overflow-wrap: break-word;
        word-wrap: break-word;
        max-width: 100%;
        min-height: 100%;
        overflow: hidden;
        outline: none;
        cursor: text;
      }
      .editing {
        padding: 5px; /* adjust this value as needed */
        box-sizing: border-box;
        background-color: #f0f0f0; /* light gray */
        border-radius: 5px;
      }

      .markDone,
      .deleteBtn,
      .saveBtn {
        position: absolute;
        top: -15px;
        width: 30px;
        height: 30px;
        border-radius: 30%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        outline: none;
        color: #8e44ad;
        border: none;
      }
      .markDone {
        right: 2px;
        width: 20px;
        height: 20px;
      }

      .markDone,
      .deleteBtn {
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .delallbtn {
        bottom: 10px;
        right: 30px;
        width: full;
        height: full;
        position: fixed;
        background-color: #c82121;
        color: white;
        border-radius: 5px;
        padding: 10px;
        border: none;
        cursor: pointer;
        align-items: center;
        justify-content: center;
      }
      /* Show buttons on sticky hover */
      .sticky:hover .markDone,
      .sticky:hover .deleteBtn,
      .sticky:hover .saveBtn {
        opacity: 1;
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="stickyWall">
      <!-- Stickies will be added here -->
    </div>
    <button type="button" class="plus-task" id="addSticky" aria-label="Add Sticky">
      <i class="fas fa-plus-circle"></i>
    </button>
    <button class="delallbtn" id="deleteAllBtn">Delete All Stickies</button>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const addStickyBtn = document.getElementById("addSticky");
        const stickyWall = document.getElementById("stickyWall");
        let zIndexCounter = 1;
        const defaultTitle = "New Sticky"; // Default sticky content
        const defaultText = "Double click to edit"; // Default sticky content
        const deleteAllBtn = document.getElementById("deleteAllBtn");

        deleteAllBtn.addEventListener("click", function () {
          // Confirm if the user really wants to delete all
          if (window.confirm("Are you sure you want to delete all stickies?")) {
            // Remove all stickies from the page
            document.querySelectorAll(".sticky").forEach((sticky) => {
              sticky.remove();
            });
            // Clear stickies from local storage
            localStorage.removeItem("tasks");
          }
        });
        addStickyBtn.addEventListener("click", function () {
          createSticky(defaultTitle, defaultText);
        });

        document.addEventListener("dblclick", function (event) {
          if (
            !event.target.closest("#addSticky") &&
            event.target !== document.getElementById("newStickyText") &&
            !event.target.closest(".sticky")
          ) {
            const stickyElem = createSticky(defaultTitle, defaultText);
            const mouseX = event.clientX;
            const mouseY = event.clientY;
            stickyElem.style.left = mouseX + "px";
            stickyElem.style.top = mouseY + "px";
          }
        });

        function createSticky(title, text) {
          const sticky = document.createElement("div");
          sticky.className = "sticky";
          sticky.innerHTML = `
              <div class="sticky-inner-content">
                  <div class="stickyTitle">${title}</div>
                  <div class="stickyText">${text}</div>
              </div>
              <input type="checkbox" class="markDone">
              <button class="deleteBtn"><span class="fas fa-trash"></span></button>
              <button class="saveBtn hidden"><span class="fas fa-save"></span></button>
              `;

          const randomColor = getRandomColor();
          const markDoneCheckbox = sticky.querySelector(".markDone");
          const deleteBtn = sticky.querySelector(".deleteBtn");
          const stickyTitle = sticky.querySelector(".stickyTitle");
          const stickyText = sticky.querySelector(".stickyText");
          const saveBtn = sticky.querySelector(".saveBtn");

          function toggleEditableState(element) {
            if (!element.isContentEditable) {
              element.setAttribute("contenteditable", "true");
              element.classList.add("editing");
              saveBtn.style.display = "block";
              element.focus();
            } else {
              element.setAttribute("contenteditable", "false");
              element.classList.remove("editing");
              saveBtn.style.display = "none";
              saveTasks();
            }
          }

          [stickyTitle, stickyText].forEach((elem) => {
            elem.addEventListener("dblclick", function () {
              toggleEditableState(elem);
            });

            elem.addEventListener("keydown", function (e) {
              if (e.key === "Enter") {
                if (!e.shiftKey) {
                  e.preventDefault();
                  toggleEditableState(elem);
                }
              }
            });

            elem.addEventListener("blur", function () {
              if (elem.isContentEditable) {
                toggleEditableState(elem);
              }
            });
          });

          saveBtn.addEventListener("click", function () {
            toggleEditableState(stickyText);
            toggleEditableState(stickyTitle);
          });

          markDoneCheckbox.addEventListener("change", function () {
            stickyText.style.textDecoration = this.checked
              ? "line-through"
              : "none";
            saveTasks();
          });

          deleteBtn.addEventListener("click", function () {
            sticky.remove();
            saveTasks();
          });

          sticky.style.backgroundColor = randomColor;
          sticky.style.left = stickyWall.offsetWidth - 1200 + "px";
          sticky.style.top = stickyWall.offsetHeight - 300 + "px";

          stickyWall.appendChild(sticky);

          sticky.addEventListener("mousedown", function (e) {
            let offsetX = e.clientX - sticky.getBoundingClientRect().left;
            let offsetY = e.clientY - sticky.getBoundingClientRect().top;

            sticky.style.zIndex = zIndexCounter++;

            document.addEventListener("mousemove", onMouseMove);
            document.addEventListener("mouseup", onMouseUp);

            function onMouseMove(e) {
              sticky.style.left = e.clientX - offsetX + "px";
              sticky.style.top = e.clientY - offsetY + "px";
            }

            function onMouseUp() {
              document.removeEventListener("mousemove", onMouseMove);
              document.removeEventListener("mouseup", onMouseUp);
              saveTasks();
            }
          });

          return sticky; // Return the sticky element for any post-processing
        }

        function getRandomColor() {
          const letters = "0123456789ABCDEF";
          let color = "#";
          for (let i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
          }
          return color;
        }

        function saveTasks() {
          const tasks = Array.from(document.querySelectorAll(".sticky")).map(
            (sticky) => {
              return {
                title: sticky.querySelector(".stickyTitle").innerHTML,
                text: sticky.querySelector(".stickyText").innerHTML,
                isDone: sticky.querySelector(".markDone").checked,
                color: sticky.style.backgroundColor,
                left: sticky.style.left,
                top: sticky.style.top,
              };
            }
          );
          localStorage.setItem("tasks", JSON.stringify(tasks));
        }

        function loadTasks() {
          const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
          tasks.forEach((task) => {
            const stickyElem = createSticky(task.title, task.text);
            stickyElem.querySelector(".markDone").checked = task.isDone;
            if (task.isDone) {
              stickyElem.querySelector(".stickyText").style.textDecoration =
                "line-through";
            }
            stickyElem.style.backgroundColor = task.color;
            stickyElem.style.left = task.left;
            stickyElem.style.top = task.top;
          });
        }

        loadTasks();
      });
    </script>
  </body>
</html>
